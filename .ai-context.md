# Контекст проекта для LLM-ассистентов

## Описание проекта

Это личная база знаний AXTRACE, построенная на базе [Diplodoc](https://diplodoc.com/) — инструмента для создания технической документации от Яндекса.

**Важно**: Проект использует Diplodoc для генерации статического сайта, который автоматически разворачивается на GitHub Pages.

## Технологический стек

- **Diplodoc** (`@diplodoc/cli`) — генератор статической документации
- **YFM (Yandex Flavored Markdown)** — расширенный синтаксис Markdown
- **GitHub Actions** — CI/CD для автоматического деплоя
- **GitHub Pages** — хостинг статического сайта
- **Node.js** — для скриптов сборки и локальной разработки
- **Yandex.Metrika** — веб-аналитика (ID: 54428956)

## Структура проекта

```
/
├── .github/workflows/
│   └── static.yml          # GitHub Actions workflow для деплоя
├── docs/                   # Исходные markdown файлы
│   ├── index.md           # Главная страница
│   ├── toc.yaml           # Оглавление сайта
│   ├── books/             # Раздел с книгами
│   ├── courses/           # Раздел с курсами
│   ├── health/            # Медицинские знания
│   ├── parfenon/          # Вина из Парфенона
│   ├── notes/             # Разные заметки
│   ├── anecdots/          # Анекдоты
│   └── _images/           # Изображения
├── docs-html/             # Сгенерированный HTML (не в git)
├── scripts/               # Вспомогательные скрипты
│   ├── inject-metrika.js  # Инжекция Yandex.Metrika
│   ├── serve.js           # Локальный dev-сервер
│   └── ...
├── .yfm                   # Конфигурация Diplodoc
├── package.json           # Зависимости Node.js
└── readme.md              # Документация проекта
```

## Ключевые файлы конфигурации

### `.yfm` — конфигурация Diplodoc

```yaml
input: ./docs              # Исходники
output: ./docs-html        # Результат сборки
allowHTML: true            # Разрешить HTML в markdown
apply-presets: true        # Применять пресеты
varsPreset: external       # Использовать внешние переменные
langs: ['ru']              # Язык документации

vars:
  project-name: "AXTRACE Knowledge Base"
  site-url: "https://axtrace.github.io"

docs-viewer:
  metrika: 54428956        # ID Yandex.Metrika
  favicon-src: "..."       # Фавикон
```

### `docs/toc.yaml` — структура навигации

Определяет структуру меню и навигации по сайту. Использует формат YAML с поддержкой:
- Вложенных разделов
- Включения других toc.yaml файлов через `include`
- Настройки логотипа и хедера

## Процесс разработки

### Локальная разработка

```bash
npm install              # Установить зависимости
npm start                # Запустить dev-сервер на http://0.0.0.0:8000
```

Dev-сервер автоматически пересобирает документацию при изменениях.

### Сборка

```bash
npm run build            # Собрать статический сайт в docs-html/
```

Команда выполняет:
1. Сборку через Diplodoc CLI
2. Генерацию HTML из markdown
3. Применение пресетов и переменных

## Процесс деплоя

### Автоматический деплой через GitHub Actions

**Триггер**: push в ветку `master`

**Workflow** (`.github/workflows/static.yml`):

1. **Checkout** — клонирование репозитория
2. **Setup Node.js** — установка Node.js 20.x
3. **Setup Pages** — настройка GitHub Pages
4. **Build docs with Diplodoc** — сборка документации через `@diplodoc/cli`
5. **Install dependencies** — установка npm зависимостей
6. **Inject Yandex Metrika** — добавление кода аналитики
7. **Upload artifact** — загрузка собранных файлов
8. **Deploy to GitHub Pages** — публикация на GitHub Pages

**Результат**: сайт доступен на `https://axtrace.github.io`

### Настройка GitHub Pages

- **Source**: GitHub Actions (не ветка!)
- **Custom domain**: не используется
- **HTTPS**: включен автоматически

## Формат контента

### YFM (Yandex Flavored Markdown)

Поддерживает стандартный Markdown плюс расширения:

**Метаданные страницы**:
```yaml
---
title: Заголовок страницы
description: Описание для SEO
metadata:
  - property: 'og:type'
    content: 'website'
---
```

**Табы**:
```markdown
{% list tabs %}

- Вкладка 1

  Контент вкладки 1

- Вкладка 2

  Контент вкладки 2

{% endlist %}
```

**Переменные**:
```markdown
{{ project-name }}
{{ site-url }}
```

**Включения**:
```yaml
- include: { mode: link, path: ./books/toc.yaml }
```

### Изображения

Хранятся в `docs/_images/` с подкаталогами по разделам:
- `docs/_images/books/desc/img/` — изображения для книг
- `docs/_images/courses/desc/img/` — изображения для курсов
- `docs/_images/health/` — медицинские изображения

Ссылки в markdown: `![alt](../_images/path/to/image.png)`

## Разделы контента

### Книги (`/books`)
- Список прочитанных книг с рецензиями
- Каждая книга — отдельный markdown файл в `docs/books/desc/`
- Навигация через `docs/books/toc.yaml`

### Курсы (`/courses`)
- Пройденные онлайн-курсы
- Заметки и материалы курсов
- Файлы курсов в `docs/courses/desc/`

### Медицина (`/health`)
- Информация о целиакии, вакцинации
- Структурированные медицинские знания

### Дополнительные разделы
- `/parfenon` — коллекция вин
- `/zakladka` — книги из программы "Закладка"
- `/yetnopozner_books` — книги из #ещенепознер
- `/notes` — разные заметки
- `/anecdots` — анекдоты

## Правила работы с проектом

### При добавлении нового контента

1. **Создать markdown файл** в соответствующем разделе `docs/`
2. **Добавить в toc.yaml** соответствующего раздела для навигации
3. **Добавить изображения** в `docs/_images/` если нужно
4. **Использовать YFM синтаксис** для расширенных возможностей
5. **Проверить локально** через `npm start`
6. **Закоммитить и запушить** в `master` для автодеплоя

### При изменении структуры

1. **Обновить toc.yaml** файлы для отражения новой структуры
2. **Проверить ссылки** между страницами
3. **Обновить readme.md** если меняется общая структура

### При работе с изображениями

1. **Размещать в `docs/_images/`** с логичной структурой папок
2. **Использовать относительные пути** от текущего файла
3. **Оптимизировать размер** изображений перед добавлением

## Важные особенности Diplodoc

1. **Не использует Jekyll** — это не GitHub Pages по умолчанию
2. **Собирается через Node.js** — требует npm/npx
3. **Поддерживает YAML конфигурацию** — `.yfm` и `toc.yaml`
4. **Встроенная поддержка метрики** — через `docs-viewer.metrika`
5. **Пресеты и переменные** — для переиспользования контента
6. **Мультиязычность** — поддержка через `langs`

## Отладка и troubleshooting

### Проблемы со сборкой
- Проверить синтаксис YAML в `.yfm` и `toc.yaml`
- Убедиться, что все файлы в UTF-8
- Проверить корректность путей к изображениям

### Проблемы с деплоем
- Проверить логи GitHub Actions
- Убедиться, что GitHub Pages настроен на "GitHub Actions"
- Проверить права доступа в настройках репозитория

### Локальные проблемы
- Очистить `docs-html/` и пересобрать
- Переустановить зависимости: `rm -rf node_modules && npm install`
- Проверить версию Node.js (требуется 20.x)

## Полезные ссылки

- [Документация Diplodoc](https://diplodoc.com/)
- [YFM синтаксис](https://ydocs.tech/)
- [GitHub Pages документация](https://docs.github.com/en/pages)
- [Сайт проекта](https://axtrace.github.io)

## Контакты и поддержка

Репозиторий: `git@github.com:axtrace/axtrace.github.io.git`
